name: Build Hanwckf 360T7 U-Boot (Fixed)

on:
  workflow_dispatch:
    inputs:
      multi_layout:
        description: '是否开启多分区布局 (0:原厂布局, 1:大分区布局)'
        required: true
        default: '0'

jobs:
  build:
    runs-on: ubuntu-latest
    steps:
      - name: 检出 Hanwckf 源码
        uses: actions/checkout@v4
        with:
          repository: 'hanwckf/bl-mt798x'

      - name: 安装编译依赖
        run: |
          sudo apt update
          sudo apt install -y gcc-aarch64-linux-gnu build-essential flex bison libssl-dev device-tree-compiler qemu-user-static

      - name: 编译 360T7
        run: |
          # 执行编译
          SOC=mt7981 BOARD=360t7 MULTI_LAYOUT=${{ github.event.inputs.multi_layout }} ./build.sh
          
          # 创建输出目录
          mkdir -p final_output
          
          # 核心修复：使用通配符匹配所有生成的 bin 文件
          # Hanwckf 的脚本会生成类似 mt7981_360t7-fip-fixed-parts.bin 的文件
          cp output/mt7981_360t7-bl2.bin final_output/bl2-360t7.bin || cp output/mt7981_360t7-bl2* final_output/bl2-360t7.bin
          cp output/mt7981_360t7-fip.bin final_output/fip-360t7.bin || cp output/mt7981_360t7-fip*.bin final_output/fip-360t7.bin
          
          echo "编译完成，已整理产物。"

      - name: 上传固件产物
        uses: actions/upload-artifact@v4
        with:
          name: 360T7-Uboot-Result
          path: final_output/

